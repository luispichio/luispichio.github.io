<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <p>    Buenas!<br>     Un año después del último artículo (como me cuesta sentarme a escribir), en base a una propuesta de un lector del blog (único comentario hasta el día de la fecha) y continuando el artículo <a href="http://luispichio.blogspot.com.ar/2015/05/arduino-generacion-de-senales-de-vga.html" target="_blank" rel="external nofollow noopener">Arduino - Generación de señales de VGA con hardware estádar</a> decidí modificar la librería para un Arduino mas potente: Arduino DUE con la finalidad de obtener mejor resolución / rendimiento y poder darle uso práctico.<br> <br></p> <div>     Las características del Arduino Due lo hacen por demás interesante para esta aplicación.<br> Cuenta con controlador Atmel AT91SAM3X8E que corre a 84mhz, 96k de ram y 512kb de flash entre otras.<br>     Los 84mhz de clock a unas 3 instrucciones por pixel permitirían teóricamente alcanzar las frecuencias requeridas para el estándar 640 x 480 (25.175mhz) aunque la memoria ram disponible no lo permite a 8bits por color (256 colores): 640 x 480 x 8bits = 307200bytes.</div> <div>     Optaremos por una resolución de 320*240*256 colores (76800bytes de RAM), resolución mas que suficiente para las aplicaciones que tengo en mente del sistema.<br> <br> <b>Implementación</b><br> <b><br></b> <b>Hardware</b><br> <br> </div> <div>     En esta oportunidad <b>no fabriqué</b> un impreso para el DAC conformado por resistencias. En su lugar armé el pack "en el aire", encinté y empaqueté con PVC.<br>     El DAC de resistencias en escalera difiere al anterior producto de que el Arduino Due utiliza 3v3 para alimentación en lugar de los 5v del Arduino estándar.<br>     Las señales de sincronismo, según especificación (bastante variada por cierto) deberían ser 0 - 5v. Prácticamente hablando no tuve problemas hasta ahora en los monitores que probé con señales 0 - 3v3.<br> <br> <div class="separator" style="clear: both; text-align: center;"> <a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgs5JkTwemfzy1iZpQHTrIjflYDk5BHc0PHwNyiMbcChFkbQQ-7Hph1GZ701GJbnZVEFMRUyqjsWlUnk4yNmbVK_DZRtJeibRk0M-68KykLwq81w2CVbCS6loiEjrovCqXgP3QGosxoCq1Q/s1600/build.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;" rel="external nofollow noopener" target="_blank"><img border="0" height="524" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgs5JkTwemfzy1iZpQHTrIjflYDk5BHc0PHwNyiMbcChFkbQQ-7Hph1GZ701GJbnZVEFMRUyqjsWlUnk4yNmbVK_DZRtJeibRk0M-68KykLwq81w2CVbCS6loiEjrovCqXgP3QGosxoCq1Q/s640/build.jpg" width="640"></a> </div> <div class="separator" style="clear: both; text-align: center;"> ladder de resistencias empaquetado en pvc</div> <div class="separator" style="clear: both; text-align: center;"> <br> </div> <div class="separator" style="clear: both; text-align: center;"> <br> </div> <b>Diagrama de conexionado</b><br> <b><br></b>     Utilizaremos al igual que en el proyecto anterior el DAC ladder con 3bits para rojo y verde y 2bits para el azul (<a href="https://en.wikipedia.org/wiki/List_of_monochrome_and_RGB_palettes#3-3-2_bit_RGB" target="_blank" rel="external nofollow noopener">RGB 3-2-2</a>).<b><br></b>    El microcontrolador cuenta con hasta 6 puertos de 32bits (hasta 32 pines) que están disponibles total o parcialmente dependiendo del modelo de controlador (encapsulado / cantidad de pines).<br>     Utilizaremos en este caso el único de los puertos (PIOD) que tiene "conexionado" al exterior desde el pin 0 del puerto (8bits menos significativos en el registro de acceso al puerto).<br>     El conexionado es algo "rebuscado" (los muchachos que diseñan los Arduino no suelen pensar en aquellas aplicaciones de tiempo crítico) pero no hay alternativas si se pretende tener el rendimiento buscado.<br> <br> <div class="separator" style="clear: both; text-align: center;"> <a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg1wWHEMyjHQi_HObKxLimci2WXqXMKOczHGbPahpk0hXXHpzuG46iibkQbjGaLrr4lDMxaalUK6uRDZgOzHJsDLGEyCNlD0aWxpPuQbYr4kCfFGzawdcfwzPvi_MQ-KXw1Npu5ep8KGwVU/s1600/Arduino+Due+VGA+-+Circuit+%2528Color%2529.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;" rel="external nofollow noopener" target="_blank"><img border="0" height="251" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg1wWHEMyjHQi_HObKxLimci2WXqXMKOczHGbPahpk0hXXHpzuG46iibkQbjGaLrr4lDMxaalUK6uRDZgOzHJsDLGEyCNlD0aWxpPuQbYr4kCfFGzawdcfwzPvi_MQ-KXw1Npu5ep8KGwVU/s640/Arduino+Due+VGA+-+Circuit+%2528Color%2529.jpg" width="640"></a> </div> <div style="text-align: center;"> diagrama de conexionado</div> <div style="text-align: center;"> <br> </div> <div style='-webkit-text-stroke-width: 0px; color: black; font-family: "Times New Roman"; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px;'> </div> <b>VGA Monocromático</b><br> <div> <br> </div> <div>     Sin implementar de momento. Veré de utilizar en lo próximo algunos de los periféricos de comunicaciones del controlador. Los primeros vistazos al USART no son muy alentadores. El baudrate máximo es FOSC / 16 (84mhz / 16 para nuestro caso = 5.25mhz), bastante por debajo de lo requerido para la resolución buscada.</div> <div> <br> <b>Software</b><br> <b><br></b>    La librería es la de <a href="http://luispichio.blogspot.com.ar/2015/05/arduino-generacion-de-senales-de-vga.html" target="_blank" rel="external nofollow noopener">Arduino VGA</a> con algunas modificaciones / agregados.<br>     En este caso ArduinoDueVGAEngine.cpp, producto de las características del microcontrolador está íntegramente escrita en C a diferencia de la anterior que está escrita mayormente en ensamblador (generación de video) por cuestiones de rendimiento.<br> <div>     Para la generación de las señales de sincronismo utilicé uno de los 9 timers de 32bits disponibles.<br> Las señales de sincronismo no tienen latencia (o es despreciable), producto de que se utiliza la funcionalidad "generación de señales" del timer. La señal de video se realiza dentro de la rutina de interrupción. Como en cualquier controlador existe una pequeña latencia variable entre el tiempo configurado y la ejecución de la rutina (código). Para compensar esto, en el artículo anterior realicé una rutina de demora variable. Luego de las primeras pruebas, al no poder "dar pié con bola" me interioricé con el funcionamiento del controlador y descubrí que cuenta con un Pipeline de 3 etapas; Hablando en criollo es capaz de ejecutar mas de una instrucción por ciclo de ejecución motivo por el cual es extremadamente dificultoso realizar rutinas de demora con la exactitud requerida. Esto deriva en un defecto de <a href="https://es.wikipedia.org/wiki/Jitter" target="_blank" rel="external nofollow noopener">Jitter</a> de video.</div> <div>     Como memoria de video se utiliza un vector de 76800bytes (320 x 240 x 8bits) como buffer intermedio de las rutinas de la clase pública y las rutinas de bajo nivel de generación de señal de video. Quedan disponibles para la aplicación ~21500 bytes de RAM.</div> <div> <br> </div> </div> <b>Librería</b><br> <br>     Al igual que el proyecto original, la librería está compuesta por una clase pública para el usuario (ArduinoDueVGA.cpp) y una librería de bajo nivel (ArduinoDueVGAEngine.cpp) con las rutinas de generación de señal.<br>     La misma es de código abierto (licencia a definir) y puede ser descargada desde la web de SourceForge desde <a href="https://sourceforge.net/projects/arduino-vga/" target="_blank" rel="external nofollow noopener">aquí</a>.<br>     Para detalles sobre la utilización referirse a apartado <b>Instalación / Utilización</b> del artículo <a href="http://luispichio.blogspot.com.ar/2015/05/arduino-generacion-de-senales-de-vga.html" target="_blank" rel="external nofollow noopener">Arduino - Generación de señales de VGA con hardware estádar</a>.<br> <br> <div style="text-indent: 0px;"> <div style="margin: 0px;"> <div style='color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;'> <b>Resultados</b> </div> <ul> <li style='color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;'>Aceptables en relación a simplicidad del circuito / software.</li> <li style='color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;'>La resolución de 320 x 240 pixeles es una de las clásicas (junto con la 320 x 200) de demoscene y juegos de los 80's / 90's es suficiente para lograr representaciones aceptables.</li> <li><span style='font-family: "times new roman";'>Independientemente del aumento de la potencia de cálculo, la generación de señal de video continúa siendo una tarea crítica:</span></li> <ul> <li><span style='font-family: "times new roman";'>La utilización de rutinas de interrupción "pesadas" puede generar Jitter de video.</span></li> <li><span style='font-family: "times new roman";'>El tiempo de procesador disponible ronda el 8%,</span></li> </ul> <li><span style='font-family: "times new roman";'>No le encontré la vuelta para poder generar la señal de video sin <a href="https://es.wikipedia.org/wiki/Jitter" target="_blank" rel="external nofollow noopener">Jitter</a>, producto de las latencias en la ejecución de rutinas de interrupción y del tiempo de ejecución variable por instrucción (Pipelines). Se observa en la imagen siguiente el defecto.</span></li> </ul> <div class="separator" style='clear: both; color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; text-align: center; text-transform: none; white-space: normal; word-spacing: 0px;'> <a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjHQ1OxXnQlvWQ4zbw5SMJcuuN3F-0nB2eScNV8iO4WEB74jqd6BwSBdV1Te4Rr-i6ts8z9Wn9_aYcCNrdCqwlUYmsweqnC7HQ9vnnSWJ-QKPuGejaJxNFV_CusBTW8i5uykxY_MN0mOKRH/s1600/jitter+%2528Custom%2529.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;" rel="external nofollow noopener" target="_blank"><img border="0" height="194" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjHQ1OxXnQlvWQ4zbw5SMJcuuN3F-0nB2eScNV8iO4WEB74jqd6BwSBdV1Te4Rr-i6ts8z9Wn9_aYcCNrdCqwlUYmsweqnC7HQ9vnnSWJ-QKPuGejaJxNFV_CusBTW8i5uykxY_MN0mOKRH/s320/jitter+%2528Custom%2529.jpg" width="320"></a> </div> <div style='color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;'> <br> </div> <div style='color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;'> <br> </div> <div style='color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;'> <b>Ejemplos</b> </div> <div style='color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;'> <b><br></b> </div> <div style='color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;'>         Van un par de videos de ejemplos de utilización:</div> <div style='color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;'>                 El primero un ejemplo que va junto con la librería de varios efectos de demoscene, algunos fractales y fuentes.</div> <div style='color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;'>                 El segundo un clon de Pacman en desarrollo (a medio terminar) que no forma parte de la librería. En cuanto lo termine lo publicaré y formará parte del contenido del blog.</div> <div style='color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;'> <br> </div> <div class="separator" style='clear: both; color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; text-align: center; text-transform: none; white-space: normal; word-spacing: 0px;'> <iframe allowfullscreen="" class="YOUTUBE-iframe-video" data-thumbnail-src="https://i.ytimg.com/vi/ZNadrVivVIQ/0.jpg" frameborder="0" height="266" src="https://www.youtube.com/embed/ZNadrVivVIQ?feature=player_embedded" width="320"></iframe><iframe allowfullscreen="" class="YOUTUBE-iframe-video" data-thumbnail-src="https://i.ytimg.com/vi/tSK98D-VxVg/0.jpg" frameborder="0" height="266" src="https://www.youtube.com/embed/tSK98D-VxVg?feature=player_embedded" width="320"></iframe> </div> <div style='color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;'> <br> </div> <div style='color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;'> <b>En lo próximo</b> </div> </div> <div style="margin: 0px;"> <span style='font-family: "times new roman";'>    Tal como lo había propuesto en el artículo anterior, tengo diseñado desde hace ya algunos meses un Shield (económico) para Arduino con un controlador mas potente (</span><span style='font-family: "times new roman";'>ATxmega) </span><span style='font-family: "times new roman";'>exclusivo para la generación de señales de video, memoria RAM onboard y algún que otro chiche.</span><br> <span style='font-family: "times new roman";'>    En cuanto tenga un rato voy a "cocinar" el impreso y empezaré a escribir algo de código.</span><br> <span style='font-family: "times new roman";'>    Estará disponible en cuanto lo tenga listo para publicar (al ritmo que vengo lamentablemente dentro de un año :P).</span><br> <br> <div class="separator" style="clear: both; text-align: center;"> <a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi2uysl6iwmeaXGYi1ukYMNB1jz8oltIP4GdjgI6ppX1yYdWRh8xWAfsSwAY3dZihSey2X6UkMOSC7TseTjdRf9NfIdEgm3rR39tGL9RLHu0Sv-qCui1260wq8FjS6kfSL6x3CdRhwzS7rg/s1600/ArduinoVGAShield.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;" rel="external nofollow noopener" target="_blank"><img border="0" height="380" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi2uysl6iwmeaXGYi1ukYMNB1jz8oltIP4GdjgI6ppX1yYdWRh8xWAfsSwAY3dZihSey2X6UkMOSC7TseTjdRf9NfIdEgm3rR39tGL9RLHu0Sv-qCui1260wq8FjS6kfSL6x3CdRhwzS7rg/s640/ArduinoVGAShield.png" width="640"></a> </div> <span style='font-family: "times new roman";'><br></span> <span style='font-family: "times new roman";'>    </span><br> <span style='font-family: "times new roman";'>  Doy por terminado este artículo, espero el contenido haya sido de utilidad.</span><br> <span style='font-family: "times new roman";'>  Cualquier duda no duden en consultar, nos vemos en la siguiente entrada.</span><br> <span style='font-family: "times new roman";'>  Saludos, Luis.-</span><br> <div style='color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;'> <span style='font-family: "times new roman";'><br></span> </div> <div style='color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;'> <span style='font-family: "times new roman";'><b>Referencias</b></span> </div> <div style='color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; text-transform: none; white-space: normal; word-spacing: 0px;'> <span style='font-family: "times new roman";'><b><br></b></span> </div> <span style='font-family: "times new roman";'><b>Arduino - Generación de señales de VGA con hardware estádar</b></span><br> <span style='font-family: "times new roman";'>  <a href="http://luispichio.blogspot.com.ar/2015/05/arduino-generacion-de-senales-de-vga.html" rel="external nofollow noopener" target="_blank">http://luispichio.blogspot.com.ar/2015/05/arduino-generacion-de-senales-de-vga.html</a></span><br> <span style='font-family: "times new roman";'><b>Arduino Due</b></span><br> <span style='font-family: "times new roman";'>  <a href="https://www.arduino.cc/en/Main/ArduinoBoardDue" rel="external nofollow noopener" target="_blank">https://www.arduino.cc/en/Main/ArduinoBoardDue</a></span><br> <span style='font-family: "times new roman";'>  <a href="https://www.arduino.cc/en/uploads/Main/arduino-Due-schematic.pdf" rel="external nofollow noopener" target="_blank">https://www.arduino.cc/en/uploads/Main/arduino-Due-schematic.pdf</a></span> </div> <div style='color: black; font-family: "times new roman"; font-size: medium; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: normal; margin: 0px; text-transform: none; white-space: normal; word-spacing: 0px;'> <b>Calculador ladder: RL-DAC</b> </div> </div>   <a href="https://code.google.com/archive/p/rl-dac/" rel="external nofollow noopener" target="_blank">https://code.google.com/archive/p/rl-dac/</a><br>   <a href="https://raronoff.wordpress.com/2012/10/17/rl-dac/" rel="external nofollow noopener" target="_blank">https://raronoff.wordpress.com/2012/10/17/rl-dac/</a> </div> </body></html>